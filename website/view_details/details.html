<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Property Details</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <nav class="bg-blue-900 text-white p-4 sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">A To Z PROPERTIES</h1>
            <a href="../index.html" class="bg-orange-500 px-4 py-2 rounded">Back</a>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-8">
        <div id="property-detail" class="bg-white rounded-lg shadow-md overflow-hidden">
            <img id="detail-img" src="" alt="Property image" class="w-full h-72 object-cover">
            <div class="p-6">
                <h2 id="detail-title" class="text-2xl font-bold mb-2"></h2>
                <div class="text-gray-700 mb-4 property-meta">
                    <div><strong>Type:</strong> <span id="detail-type"></span></div>
                    <div><strong>Location:</strong> <span id="detail-location"></span></div>
                    <div><strong>Furniture:</strong> <span id="detail-furniture"></span></div>
                </div>

                <h3 class="text-xl font-semibold mb-2">Book a Site Visit</h3>
                <form id="property-booking" class="space-y-3 text-black max-w-md">
                    <input id="visitor-name" type="text" placeholder="Your Name" required class="w-full p-2 rounded border">
                    <input id="visitor-phone" type="tel" placeholder="Your Phone" required class="w-full p-2 rounded border">
                    <input id="visit-date" type="date" required class="w-full p-2 rounded border">
                    <select id="visit-slot" required class="w-full p-2 rounded border"></select>
                    <button type="submit" class="w-full bg-orange-500 text-white py-2 rounded">Confirm Visit</button>
                </form>
                <div id="booking-result" class="mt-4"></div>
            </div>
        </div>
    </main>

    <script>
    const STORAGE_KEY = 'properties_v1';
    const BOOKINGS_KEY = 'bookings_v1';

    function qs(name){ return new URLSearchParams(location.search).get(name); }
    const id = qs('id');
    const properties = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
    const property = properties.find(p => String(p.id) === String(id));

    const container = document.getElementById('property-detail');
    if (!property) {
        // show not found using DOM methods
        container.innerHTML = '';
        const msg = document.createElement('div');
        msg.className = 'p-8';
        msg.textContent = 'Property not found.';
        const link = document.createElement('a');
        link.href = 'index.html';
        link.className = 'text-blue-600 block mt-2';
        link.textContent = 'Back to listings';
        msg.appendChild(link);
        container.appendChild(msg);
    } else {
        // populate DOM elements (no HTML injection)
        document.getElementById('detail-img').src = property.img || '';
        document.getElementById('detail-img').alt = property.title || 'Property image';
        document.getElementById('detail-title').textContent = property.title || '';
        document.getElementById('detail-type').textContent = property.type || '';
        document.getElementById('detail-location').textContent = property.location || '';
        document.getElementById('detail-furniture').textContent = property.furnitureType || '';

        // generate slots
        function formatTime(h,m){
            const d = new Date(); d.setHours(h); d.setMinutes(m);
            return d.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }
        function generateSlots(){
            const slots = [];
            function addRange(sh, sm, eh, em){
                let start = sh*60 + sm;
                const end = eh*60 + em;
                while(start <= end){
                    const hh = Math.floor(start/60);
                    const mm = start % 60;
                    slots.push({value: `${String(hh).padStart(2,'0')}:${String(mm).padStart(2,'0')}`, label: formatTime(hh,mm)});
                    start += 30;
                }
            }
            addRange(10,0,13,0); // 10:00 - 13:00
            addRange(16,0,21,30); // 16:00 - 21:30
            return slots;
        }

        const slotSelect = document.getElementById('visit-slot');
        const slots = generateSlots();
        slots.forEach(s => { const opt = document.createElement('option'); opt.value = s.value; opt.textContent = s.label; slotSelect.appendChild(opt); });

        // Booking submit
        document.getElementById('property-booking').addEventListener('submit', function(e){
            e.preventDefault();
            const name = document.getElementById('visitor-name').value;
            const phone = document.getElementById('visitor-phone').value;
            const date = document.getElementById('visit-date').value;
            const slot = document.getElementById('visit-slot').value;
            if(!date || !slot){ alert('Please choose a date and time slot'); return; }
            const bookings = JSON.parse(localStorage.getItem(BOOKINGS_KEY) || '[]');
            const booking = { id: Date.now(), propertyId: property.id, name, phone, date, slot };
            bookings.push(booking);
            localStorage.setItem(BOOKINGS_KEY, JSON.stringify(bookings));
            const result = document.getElementById('booking-result');
            result.textContent = '';
            const note = document.createElement('div');
            note.className = 'p-3 bg-green-100 text-green-800 rounded';
            note.textContent = `Booking confirmed for ${date} at ${slot}. We will contact you at ${phone}.`;
            result.appendChild(note);
            this.reset();
        });
    }
    </script>
</body>
</html>
